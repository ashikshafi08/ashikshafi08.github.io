<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Building Weave: Pipeline Orchestration and Monitoring (Part 4) | Ashik Syed Shaffiullah</title> <meta name="author" content="Ashik Syed Shaffiullah"> <meta name="description" content="Deep dive into Weave's pipeline orchestration system for managing complex data generation workflows"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://ashikshafi08.github.io/blog/2024/weave-part4/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?6185d15ea1982787ad7f435576553d64"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Ashik </span>Syed Shaffiullah</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Building Weave: Pipeline Orchestration and Monitoring (Part 4)</h1> <p class="post-meta">March 24, 2024</p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/llm"> <i class="fa-solid fa-hashtag fa-sm"></i> llm</a>   <a href="/blog/tag/synthetic-data"> <i class="fa-solid fa-hashtag fa-sm"></i> synthetic-data</a>   <a href="/blog/tag/orchestration"> <i class="fa-solid fa-hashtag fa-sm"></i> orchestration</a>   <a href="/blog/tag/python"> <i class="fa-solid fa-hashtag fa-sm"></i> python</a>     ·   <a href="/blog/category/ai-ml"> <i class="fa-solid fa-tag fa-sm"></i> ai-ml</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <blockquote> <p>Check out the <a href="https://github.com/ashikshafi08/weave" rel="external nofollow noopener" target="_blank">Weave Framework on GitHub</a> to explore the code and contribute!</p> </blockquote> <p>In <a href="./2024-03-23-weave-part3">Part 3</a>, we explored Weave’s dataset management system. Today, we’ll conclude our series by diving into the orchestration system that ties everything together, enabling complex data generation pipelines that are both reliable and scalable.</p> <h2 id="the-orchestration-challenge">The Orchestration Challenge</h2> <p>Building data generation pipelines presents unique challenges:</p> <ul> <li>Managing complex dependencies between steps</li> <li>Handling failures gracefully</li> <li>Optimizing resource usage</li> <li>Monitoring pipeline health</li> <li>Ensuring reproducibility</li> </ul> <h2 id="the-orchestrator-module">The Orchestrator Module</h2> <p>At the heart of Weave’s orchestration system is the Orchestrator class:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># weave/orchestrators/base.py
</span><span class="k">class</span> <span class="nc">Orchestrator</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Core orchestration engine.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="nc">Pipeline</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">monitor</span> <span class="o">=</span> <span class="nc">Monitor</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">resource_manager</span> <span class="o">=</span> <span class="nc">ResourceManager</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">build_pipeline</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PipelineStep</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Pipeline</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Construct a pipeline from steps.</span><span class="sh">"""</span>
        <span class="c1"># Validate step dependencies
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">_validate_dependencies</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        
        <span class="c1"># Optimize step ordering
</span>        <span class="n">ordered_steps</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_optimize_order</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
        
        <span class="c1"># Configure monitoring
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">_setup_monitoring</span><span class="p">(</span><span class="n">ordered_steps</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="nc">Pipeline</span><span class="p">(</span><span class="n">ordered_steps</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Execute pipeline with monitoring and error handling.</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Initialize monitoring
</span>            <span class="n">self</span><span class="p">.</span><span class="n">monitor</span><span class="p">.</span><span class="nf">start_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
            
            <span class="c1"># Execute steps
</span>            <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_execute_steps</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            
            <span class="c1"># Finalize monitoring
</span>            <span class="n">self</span><span class="p">.</span><span class="n">monitor</span><span class="p">.</span><span class="nf">complete_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">result</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">monitor</span><span class="p">.</span><span class="nf">fail_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span>
</code></pre></div></div> <h2 id="pipeline-definition">Pipeline Definition</h2> <p>Pipelines are defined using a declarative syntax:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># weave/orchestrators/pipeline.py
</span><span class="k">class</span> <span class="nc">Pipeline</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Data generation pipeline definition.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PipelineStep</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">status</span> <span class="o">=</span> <span class="nc">PipelineStatus</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="nc">PipelineMetrics</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">add_step</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">PipelineStep</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Add a step to the pipeline.</span><span class="sh">"""</span>
        <span class="c1"># Validate step compatibility
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">_validate_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        
        <span class="c1"># Add step with metadata
</span>        <span class="n">self</span><span class="p">.</span><span class="n">steps</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">_enrich_step</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">_enrich_step</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">PipelineStep</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PipelineStep</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Add metadata and monitoring to step.</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="nc">StepWrapper</span><span class="p">(</span>
            <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span>
            <span class="n">metrics</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">,</span>
            <span class="n">retries</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">retries</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">timeout</span>
        <span class="p">)</span>
</code></pre></div></div> <h2 id="resource-management">Resource Management</h2> <p>The system carefully manages computational resources:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># weave/orchestrators/resources.py
</span><span class="k">class</span> <span class="nc">ResourceManager</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Manage computational resources.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">max_memory_gb</span><span class="sh">"</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_concurrent</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">max_concurrent</span><span class="sh">"</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">gpu_enabled</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">gpu_enabled</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">allocate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">PipelineStep</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Resources</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Allocate resources for a step.</span><span class="sh">"""</span>
        <span class="n">requirements</span> <span class="o">=</span> <span class="n">step</span><span class="p">.</span><span class="nf">get_requirements</span><span class="p">()</span>
        
        <span class="c1"># Check resource availability
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="nf">_can_allocate</span><span class="p">(</span><span class="n">requirements</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nc">ResourceError</span><span class="p">(</span><span class="sh">"</span><span class="s">Insufficient resources</span><span class="sh">"</span><span class="p">)</span>
            
        <span class="c1"># Allocate resources
</span>        <span class="n">allocation</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_allocate_resources</span><span class="p">(</span><span class="n">requirements</span><span class="p">)</span>
        
        <span class="c1"># Track allocation
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">_track_allocation</span><span class="p">(</span><span class="n">allocation</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">allocation</span>
</code></pre></div></div> <h2 id="error-handling-and-retries">Error Handling and Retries</h2> <p>Robust error handling is crucial for production pipelines:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># weave/orchestrators/error_handling.py
</span><span class="k">class</span> <span class="nc">ErrorHandler</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Handle pipeline errors with retries.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">max_retries</span><span class="sh">"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">retry_delay</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">retry_delay</span><span class="sh">"</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">error_patterns</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_error_patterns</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="nb">Exception</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">PipelineStep</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Action</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Determine how to handle an error.</span><span class="sh">"""</span>
        <span class="c1"># Analyze error
</span>        <span class="n">error_type</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_classify_error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        
        <span class="c1"># Check retry policy
</span>        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">_should_retry</span><span class="p">(</span><span class="n">error_type</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_create_retry_action</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            
        <span class="c1"># Handle fatal error
</span>        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_handle_fatal_error</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_should_retry</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">error_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">PipelineStep</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Determine if step should be retried.</span><span class="sh">"""</span>
        <span class="nf">return </span><span class="p">(</span>
            <span class="n">error_type</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">retryable_errors</span> <span class="ow">and</span>
            <span class="n">step</span><span class="p">.</span><span class="n">retries</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">max_retries</span>
        <span class="p">)</span>
</code></pre></div></div> <h2 id="monitoring-and-metrics">Monitoring and Metrics</h2> <p>Comprehensive monitoring ensures pipeline health:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># weave/orchestrators/monitoring.py
</span><span class="k">class</span> <span class="nc">Monitor</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Pipeline monitoring system.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="nc">MetricsCollector</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">logger</span> <span class="o">=</span> <span class="nc">Logger</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">alerts</span> <span class="o">=</span> <span class="nc">AlertManager</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">track_step</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">PipelineStep</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Track step execution metrics.</span><span class="sh">"""</span>
        <span class="c1"># Record timing
</span>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Execute step
</span>            <span class="n">result</span> <span class="o">=</span> <span class="n">step</span><span class="p">.</span><span class="nf">execute</span><span class="p">()</span>
            
            <span class="c1"># Record success metrics
</span>            <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">.</span><span class="nf">record_success</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Record failure metrics
</span>            <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">.</span><span class="nf">record_failure</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span>
            
    <span class="k">def</span> <span class="nf">get_pipeline_stats</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">Get pipeline statistics.</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">success_rate</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calc_success_rate</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">avg_duration</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calc_avg_duration</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">resource_usage</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_resource_usage</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">error_rates</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_error_rates</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div> <h2 id="performance-optimization">Performance Optimization</h2> <p>The system includes several optimizations:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># weave/orchestrators/optimization.py
</span><span class="k">class</span> <span class="nc">PipelineOptimizer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Optimize pipeline execution.</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pipeline</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Apply pipeline optimizations.</span><span class="sh">"""</span>
        <span class="n">optimized</span> <span class="o">=</span> <span class="n">pipeline</span>
        
        <span class="c1"># Parallelize independent steps
</span>        <span class="n">optimized</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_parallelize_steps</span><span class="p">(</span><span class="n">optimized</span><span class="p">)</span>
        
        <span class="c1"># Optimize resource allocation
</span>        <span class="n">optimized</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_optimize_resources</span><span class="p">(</span><span class="n">optimized</span><span class="p">)</span>
        
        <span class="c1"># Cache intermediate results
</span>        <span class="n">optimized</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_add_caching</span><span class="p">(</span><span class="n">optimized</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">optimized</span>
        
    <span class="k">def</span> <span class="nf">_parallelize_steps</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pipeline</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Identify and parallelize independent steps.</span><span class="sh">"""</span>
        <span class="n">dag</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_build_dependency_graph</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_schedule_parallel_execution</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
</code></pre></div></div> <h2 id="real-world-example">Real-World Example</h2> <p>Here’s how it all comes together:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Example pipeline definition
</span><span class="n">pipeline</span> <span class="o">=</span> <span class="nc">Orchestrator</span><span class="p">().</span><span class="nf">build_pipeline</span><span class="p">([</span>
    <span class="nc">LoadDataStep</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="sh">"</span><span class="s">raw_data.csv</span><span class="sh">"</span><span class="p">),</span>
    <span class="nc">CleaningStep</span><span class="p">(</span><span class="n">rules</span><span class="o">=</span><span class="n">cleaning_rules</span><span class="p">),</span>
    <span class="nc">AugmentationStep</span><span class="p">(</span>
        <span class="n">noiser</span><span class="o">=</span><span class="nc">StyleTransferNoiser</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="sh">"</span><span class="s">technical</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="nc">ValidationStep</span><span class="p">(</span><span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">completeness</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">coherence</span><span class="sh">"</span><span class="p">]),</span>
    <span class="nc">ExportStep</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="sh">"</span><span class="s">processed_data.jsonl</span><span class="sh">"</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Run with monitoring
</span><span class="n">results</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span>
    <span class="n">monitoring</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">alerts</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">resource_limits</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">max_memory</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">4GB</span><span class="sh">"</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div> <h2 id="success-metrics">Success Metrics</h2> <p>Our orchestration system has proven its value:</p> <ul> <li><strong>99.9% Pipeline Reliability</strong></li> <li> <strong>60% Faster</strong> execution through parallelization</li> <li> <strong>85% Reduction</strong> in resource-related failures</li> <li> <strong>100% Visibility</strong> into pipeline performance</li> </ul> <h2 id="best-practices">Best Practices</h2> <p>Key lessons learned from building and running pipelines:</p> <ol> <li> <strong>Design for Failure</strong>: <ul> <li>Implement comprehensive error handling</li> <li>Use retries with backoff</li> <li>Plan for resource constraints</li> </ul> </li> <li> <strong>Monitor Everything</strong>: <ul> <li>Track step-level metrics</li> <li>Monitor resource usage</li> <li>Set up alerting</li> </ul> </li> <li> <strong>Optimize Intelligently</strong>: <ul> <li>Parallelize where possible</li> <li>Cache intermediate results</li> <li>Balance resources carefully</li> </ul> </li> </ol> <h2 id="series-conclusion">Series Conclusion</h2> <p>Over this four-part series, we’ve explored how Weave:</p> <ol> <li>Provides a robust framework for synthetic data generation</li> <li>Implements sophisticated data transformation</li> <li>Manages datasets efficiently</li> <li>Orchestrates complex pipelines reliably</li> </ol> <p>The result is a powerful tool that’s helping teams:</p> <ul> <li>Generate high-quality synthetic data</li> <li>Reduce data preparation time</li> <li>Ensure reproducible pipelines</li> <li>Scale their ML operations</li> </ul> <h2 id="whats-next">What’s Next?</h2> <p>We’re continuing to evolve Weave with:</p> <ul> <li>More sophisticated noising strategies</li> <li>Enhanced monitoring capabilities</li> <li>Better resource optimization</li> <li>Expanded format support</li> </ul> <p>Stay tuned for more updates!</p> <blockquote> <p>💡 <strong>Want to contribute?</strong> Check out our <a href="https://github.com/ashikshafi08/weave" rel="external nofollow noopener" target="_blank">GitHub repository</a> and join our growing community of contributors!</p> </blockquote> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/weave-part3/">Building Weave: Intelligent Dataset Management (Part 3)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/weave-part1/">Building Weave: A Modern Synthetic Data Generation Framework (Part 1)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/weave-part2/">Building Weave: Advanced Data Transformation with Noisers (Part 2)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/autonomous-bug-fixing/">Building an Autonomous Bug Fixing System with RAG and LLMs</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/llm-synthetic-data/">Synthetic Data Generation for LLM Fine-tuning - A Deep Dive</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Ashik Syed Shaffiullah. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?9b43d6e67ddc7c0855b1478ee4c48c2d" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>